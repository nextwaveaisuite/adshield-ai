import { getServerSession } from 'next-auth/next'; import { authOptions } from '../../../lib/auth'; import { upsertMember } from '../../../lib/team'; export default async function h(req,res){const s=await getServerSession(req,res,authOptions); if(!s) return res.status(401).json({}); if((s.user.role||'member')!=='admin') return res.status(403).json({}); if(req.method!=='POST'){res.setHeader('Allow',['POST']); return res.status(405).json({});} const {email,role}=typeof req.body==='string'?JSON.parse(req.body):(req.body||{}); if(!email||!['member','analyst','admin'].includes(role)) return res.status(400).json({}); const data=await upsertMember(email,role); res.status(200).json({ok:true,member:data});}
