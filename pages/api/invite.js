import crypto from 'crypto';import { supabaseAdmin } from '../../lib/supabaseAdmin';export default async function handler(req,res){if(req.method!=='POST') return res.status(405).json({error:'Method not allowed'});const {email,role='member'}=req.body||{};if(!email) return res.status(400).json({error:'email required'});if(!['member','analyst','admin'].includes(role)) return res.status(400).json({error:'invalid role'});const token=crypto.randomBytes(24).toString('hex');const {error}=await supabaseAdmin.from('invites').insert({email,role,token});if(error) return res.status(400).json({error:error.message});const base=process.env.NEXTAUTH_URL||'';const joinUrl=`${base}/join?token=${token}`;return res.status(200).json({ok:true,email,role,joinUrl});}