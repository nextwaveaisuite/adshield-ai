import { getSession } from 'next-auth/react';import React from 'react';import Dashboard from '../../components/Dashboard';export async function getServerSideProps(ctx){const session=await getSession(ctx);if(!session) return {redirect:{destination:'/login',permanent:false}};if(session.user.role!=='admin') return {notFound:true};return {props:{}};}export default function TeamPage(){const [members,setMembers]=React.useState([]);const [email,setEmail]=React.useState('');const [role,setRole]=React.useState('member');const [inviteLink,setInviteLink]=React.useState('');async function refresh(){const res=await fetch('/api/team/list');const json=await res.json();setMembers(json.members||[]);}React.useEffect(()=>{refresh();},[]);async function createInvite(){const res=await fetch('/api/invite',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,role})});const json=await res.json();if(!res.ok) alert(json.error||'Invite failed'); else setInviteLink(json.joinUrl);await refresh();}async function changeRole(e,r){const res=await fetch('/api/team/role',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:e,role:r})});const json=await res.json();if(!res.ok) alert(json.error||'Role change failed');await refresh();}return(<Dashboard title="Team"><div style={{display:'grid',gap:12,maxWidth:500}}><input placeholder="email@domain.com" value={email} onChange={e=>setEmail(e.target.value)} /><select value={role} onChange={e=>setRole(e.target.value)}><option value="member">member</option><option value="analyst">analyst</option><option value="admin">admin</option></select><button onClick={createInvite}>Create invite</button>{inviteLink&&<div>Invite link: <input readOnly value={inviteLink} style={{width:'100%'}} /></div>}</div><h3 style={{marginTop:24}}>Members</h3><table border="1" cellPadding="6"><thead><tr><th>Email</th><th>Role</th><th>Actions</th></tr></thead><tbody>{members.map(m=>(<tr key={m.email}><td>{m.email}</td><td>{m.role}</td><td><button onClick={()=>changeRole(m.email,'member')}>member</button><button onClick={()=>changeRole(m.email,'analyst')}>analyst</button><button onClick={()=>changeRole(m.email,'admin')}>admin</button></td></tr>))}</tbody></table></Dashboard>);}