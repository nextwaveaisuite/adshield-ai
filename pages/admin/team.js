import { getServerSession } from 'next-auth/next'; import { authOptions } from '../../lib/auth'; import Link from 'next/link'; import { useEffect, useState } from 'react'; export default function Team(){const [members,setMembers]=useState([]); const [email,setEmail]=useState(''); const [role,setRole]=useState('member'); useEffect(()=>{fetch('/api/team/list').then(r=>r.json()).then(j=>setMembers(j.members||[]));},[]); async function invite(){const r=await fetch('/api/invite',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,role})}); const j=await r.json(); if(j.url) alert('Invite: '+j.url);} return (<main style={{padding:24}}><h1>Team (admin)</h1><div><input placeholder='email' value={email} onChange={e=>setEmail(e.target.value)}/><select value={role} onChange={e=>setRole(e.target.value)}><option>member</option><option>analyst</option><option>admin</option></select><button onClick={invite}>Create Invite</button></div><ul>{members.map((m,i)=>(<li key={i}>{m.email} â€” {m.role}</li>))}</ul><p><Link href='/admin'>Back</Link></p></main>)} export async function getServerSideProps(ctx){const s=await getServerSession(ctx.req,ctx.res,authOptions); if(!s) return {redirect:{destination:'/login',permanent:false}}; if((s.user.role||'member')!=='admin') return {redirect:{destination:'/admin',permanent:false}}; return {props:{user:s.user}}}
